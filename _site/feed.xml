<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Ragagu</title>
        <description>Un espacio personal de tecnología para compartir</description>
        <link>http://localhost:4000/</link>
        <atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml"/>
        <pubDate>Wed, 13 Jul 2022 01:40:42 +0200</pubDate>
        <lastBuildDate>Wed, 13 Jul 2022 01:40:42 +0200</lastBuildDate>
        <generator>Jekyll v4.2.2</generator>
        
            <item>
                <title>Primeros pasos con Terraform y desplegando infraestructura como código en Azure</title>
                <description>&lt;p&gt;En el siguiente lab voy a instalar y configurar &lt;strong&gt;Terraform&lt;/strong&gt; en una máquina &lt;a href=&quot;https://ragagu.es/instalacion-de-wsl-y-ubuntu-22-04-lts-en-windows-11&quot; title=&quot;Instalación de WSL y Ubuntu 22.04 LTS en Windows 11&quot;&gt;Windows 11 con &lt;strong&gt;WSL&lt;/strong&gt;, haciendo uso de la distribución &lt;strong&gt;Ubuntu 22.04 LTS&lt;/strong&gt;&lt;/a&gt;, pero, el despliegue se puede llevar a cabo desde cualquier máquina con Linux. Posteriormente voy a desplegar la siguiente infraestructura en &lt;strong&gt;Azure&lt;/strong&gt;:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Un grupo de recursos.&lt;/li&gt;
  &lt;li&gt;Una máquina virtual con 2vCPU, 4GB de RAM y 30GB HDD con una imagen CentOS (master).&lt;/li&gt;
  &lt;li&gt;Dos máquinas virtuales con 1vCPU, 2GB de RAM y 30GB HDD con una imagen CentOS (workers).&lt;/li&gt;
  &lt;li&gt;Tres IPs públicas dinámicas.&lt;/li&gt;
  &lt;li&gt;Una red virtual.&lt;/li&gt;
  &lt;li&gt;Un grupo de seguridad de red (NSG).&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;preparación-del-entorno-para-automatizar-el-despliegue&quot;&gt;Preparación del entorno para automatizar el despliegue&lt;/h1&gt;

&lt;p&gt;&lt;strong&gt;En primer lugar&lt;/strong&gt;, tenemos que instalar Terraform en la máquina Linux donde se va automatizar el despliegue. De forma predeterminada, Terraform no está incluido en el repositorio estándar de Ubuntu. Debemos instalar los siguientes paquetes:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get install curl gnupg2 software-properties-common -y
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Posteriormente agregamos la clave GPG Terraform y el respositorio:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo curl -fsSL https://apt.releases.hashicorp.com/gpg | apt-key add -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-add-repository &quot;deb [arch=$(dpkg --print-architecture)] https://apt.releases.hashicorp.com 
$(lsb_release -cs) main&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Por último instalamos Terraform:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get install terraform -y
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Para verificar la instalación de Terraform ejecutamos:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;terraform -v
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/terraform-v.png&quot; alt=&quot;Ejecución de &apos;terraform -v&apos;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;En segundo lugar&lt;/strong&gt;, tenemos que crear un service principal para conectar el provider azurerm de Terraform con nuestro tenant de Azure. Hacemos uso de &lt;strong&gt;Azure CLI&lt;/strong&gt;. Instalamos Azure CLI mediante el siguiente comando:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Para crear un service principal tenemos que conectarnos al tenant de Azure con:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; az login
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Con el siguiente comando creamos el service principal:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;az ad sp create-for-rbac --role=&quot;Contributor&quot; --scopes=&quot;/subscriptions/529ff35f-375b-xxxx-xxxx-xxxxxxxxxxxx&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/creacion-service-principal.png&quot; alt=&quot;Creación de un service principal&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;creación-de-estructura-de-directorio-y-archivos-terraform&quot;&gt;Creación de estructura de directorio y archivos Terraform&lt;/h2&gt;

&lt;p&gt;Clonamos el siguiente repositorio en la máquina donde vamos automatizar el despliegue de la infraestructura con Terrafrom &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://github.com/ragagu/laboratorios&lt;/code&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Para instalar Git ejecuta el comando &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo apt install git&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Accedemos al directorio laboratorios/terraform/0001 y vemos la estructura de archivos siguientes:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;main.tf&lt;/li&gt;
  &lt;li&gt;network.tf&lt;/li&gt;
  &lt;li&gt;security.tf&lt;/li&gt;
  &lt;li&gt;vars.tf&lt;/li&gt;
  &lt;li&gt;vm.tf&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;configuración-de-archivo-varstf&quot;&gt;Configuración de archivo vars.tf&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;En este fichero declaramos todas las variables.&lt;/li&gt;
  &lt;li&gt;Declaramos la localización para ubicar en la región donde se van a desplegar los recursos. Para ver las regiones disponibles: az account list-locations&lt;/li&gt;
  &lt;li&gt;Declaramos la variable para el nombre de la talla de la máquina virtual máster. Para ver las tallas disponibles en la región seleccionada: az vm list-sizes –location westeurope&lt;/li&gt;
  &lt;li&gt;Declaramos la variable para el nombre de la talla de las máquinas workers. Como las dos VM workers van a ser iguales, solamente va a cambiar el nombre, aplicamos el tipo lists(string) y los nombres de ambas VM en default. En los archivos main.tf, network.tf, security.tf y vm.tf haremos uso de count para configurar estas dos VMs.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Si estás haciendo uso de una suscripción de educación, están limitadas a un máximo de 4 Cores, este límite se puede ampliar, pero no es posible hacerlo con este tipo de suscripción, la solución es pasar a una suscripción de pago por uso.&lt;/p&gt;

&lt;p&gt;Contenido archivo vars.tf:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Variable aplicable a todos los recursos

variable &quot;location&quot; {
  type = string
  description = &quot;Región donde se crearán los recursos de Azure&quot;
  default = &quot;West Europe&quot;
}

# Variable aplicable solo a la VM master

variable &quot;vm_size_master&quot; {
  type = string
  description = &quot;Talla para la VM master&quot;
  default = &quot;Standard_B2s&quot; # 2vCPU, 4GB RAM
}

# Variables aplicables a las VMs worker01 y worker02

variable &quot;vm_size_workers&quot; {
  type = string
  description = &quot;Talla de la VM&quot;
  default = &quot;Standard_B1ms&quot; # 1vCPU, 2GB RAM
}

variable &quot;workers&quot; {
  type = list(string)
  description = &quot;Despliegue de VMs worker01 y worker 02&quot;
  default = [&quot;worker01&quot;, &quot;worker02&quot;]
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;configuración-de-archivo-maintf&quot;&gt;Configuración de archivo main.tf&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Configuramos el provider del que hará uso Terraform, en este caso azurerm.&lt;/li&gt;
  &lt;li&gt;Incluimos la información del service principal creado.&lt;/li&gt;
  &lt;li&gt;Creamos y configuramos un grupo de recursos.&lt;/li&gt;
  &lt;li&gt;Creamos y configuramos una cuenta de almacenamiento.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Como podemos ver para la configuración location se hace llamamiento a la variable var.location, de esta forma se configuraría West Europe, tal y como está definido en vars.tf. También observamos que en todos los recursos hay que indicar el nombre del grupo de recursos donde se va a desplegar, como el nombre ya está definido en la creación del grupo de recursos, el llamamiento al nombre de este en la creación de otros recursos se establece de la siguiente forma azurerm_resource_group.rg.name.&lt;/p&gt;

&lt;p&gt;Contenido archivo main.tf:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Definición provider azurerm (Azure) y versión

terraform {
  required_providers {
    azurerm = {
      source = &quot;hashicorp/azurerm&quot;
      version = &quot;3.13.0&quot;
    }
  }
}

provider &quot;azurerm&quot; {
  features {}
  subscription_id = &quot;c9f11e84-e410-46cd-82xe-xxxxxxxxxxxx&quot;
  client_id = &quot;62p71c17-03q2-4234-9795-xxxxxxxxxxxx&quot;
  client_secret = &quot;rvFpTmn_3KCOtZv.jzoK9Ox3H-xxxxxxxx&quot;
  tenant_id = &quot;899789xd-202f-44b4-9583-xxxxxxxxxxxx&quot;
}

# Creación de grupo de recursos

resource &quot;azurerm_resource_group&quot; &quot;rg&quot; {
    name = &quot;lab_0001&quot;
    location = var.location

    tags = {
        environment = &quot;lab_0001&quot;
    }
}

# Creación de cuenta de almacenamiento

resource &quot;azurerm_storage_account&quot; &quot;stAccount&quot; {
    name = &quot;salab0001&quot;
    resource_group_name = azurerm_resource_group.rg.name
    location = azurerm_resource_group.rg.location
    account_tier = &quot;Standard&quot;
    account_replication_type = &quot;LRS&quot;

    tags = {
        environment = &quot;lab_0001&quot;
    }

}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;configuración-del-archivo-networktf&quot;&gt;Configuración del archivo network.tf&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Definimos una vnet: 10.0.0.0/16&lt;/li&gt;
  &lt;li&gt;Definimos una subnet: 10.0.1.0/24&lt;/li&gt;
  &lt;li&gt;La subnet debe estar contenida dentro de la vnet.&lt;/li&gt;
  &lt;li&gt;La NIC de todas las VMs deben estar contenidas dentro del mismo espacio de direcciones de la subnet.&lt;/li&gt;
  &lt;li&gt;Asignamos un IP privada estática a las VMs.&lt;/li&gt;
  &lt;li&gt;Creamos una IP pública dinámica para poder acceder desde fuera de Azure.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;La asignación de una IP pública estática incrementa el coste de este recurso, sin embargo, la asignación de una IP privada estática es gratuita. Al configurar la IP pública dinámica, con el encendido y apagado de las VMs la dirección puede cambiar. En la creación de los workers en el nombre del recurso se establece -${var.workers[count.index]} para que automáticamente coja del fichero vars.tf de la variable workers los nombres definidos en default. Para que eso funcione se declara también en el recurso a crear count = length(var.workers). Como a la VM master le hemos dado la IP 10.0.1.10, para que los workers se asignen automáticamente la primera IP privada libre a partir de las 10.0.1.11 para que no se duplique la IP del master, aplicamos la siguiente configuración private_ip_address = “10.0.1.${count.index + 11}”.&lt;/p&gt;

&lt;p&gt;Contenido de archivo network.tf:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Creación de red virtual

resource &quot;azurerm_virtual_network&quot; &quot;myNet&quot; {
    name = &quot;lab-0001-vnet&quot;
    address_space = [&quot;10.0.0.0/16&quot;]
    location = azurerm_resource_group.rg.location
    resource_group_name = azurerm_resource_group.rg.name

    tags = {
        environment = &quot;lab-0001&quot;
    }
}

# Creación de subnet

resource &quot;azurerm_subnet&quot; &quot;mySubnet&quot; {
    name = &quot;subnet-lab-0001&quot;
    resource_group_name = azurerm_resource_group.rg.name
    virtual_network_name = azurerm_virtual_network.myNet.name
    address_prefixes = [&quot;10.0.1.0/24&quot;]
}

# Creación de interfaz de red para VM master

resource &quot;azurerm_network_interface&quot; &quot;nicmaster&quot; {
    name = &quot;nic-master&quot;
    location = azurerm_resource_group.rg.location
    resource_group_name = azurerm_resource_group.rg.name

      ip_configuration {
      name = &quot;ipconf-master&quot;
      subnet_id = azurerm_subnet.mySubnet.id
      private_ip_address_allocation = &quot;Static&quot;
      private_ip_address = &quot;10.0.1.10&quot;
      public_ip_address_id = azurerm_public_ip.myPublicIpMaster.id
}

      tags = {
          environment = &quot;lab-0001&quot;
      }
}

# Creación de interfaces de red para VMs worker01 y worker02

resource &quot;azurerm_network_interface&quot; &quot;nicworkers&quot; {
    name = &quot;nic-${var.workers[count.index]}&quot;
    count = length(var.workers)
    location = azurerm_resource_group.rg.location
    resource_group_name = azurerm_resource_group.rg.name

      ip_configuration {
      name = &quot;ipconf-${var.workers[count.index]}&quot;
      subnet_id = azurerm_subnet.mySubnet.id
      private_ip_address_allocation = &quot;Static&quot;
      private_ip_address = &quot;10.0.1.${count.index + 11}&quot;
      public_ip_address_id = azurerm_public_ip.myPublicIpWorkers[count.index].id
}

      tags = {
          environment = &quot;lab-0001&quot;
      }
}

# IP pública VM master

resource &quot;azurerm_public_ip&quot; &quot;myPublicIpMaster&quot; {
    name = &quot;publicip-master&quot;
    location = azurerm_resource_group.rg.location
    resource_group_name = azurerm_resource_group.rg.name
    allocation_method = &quot;Dynamic&quot;
    sku = &quot;Basic&quot;

      tags = {
          environment = &quot;lab-lab0001&quot;
      }
}

# IP pública VMs worker01 y worker02

resource &quot;azurerm_public_ip&quot; &quot;myPublicIpWorkers&quot; {
    name = &quot;publicip-${var.workers[count.index]}&quot;
    count = length(var.workers)
    location = azurerm_resource_group.rg.location
    resource_group_name = azurerm_resource_group.rg.name
    allocation_method = &quot;Dynamic&quot;
    sku = &quot;Basic&quot;

      tags = {
          environment = &quot;lab-0001&quot;
      }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;configuración-del-archivo-securitytf&quot;&gt;Configuración del archivo security.tf&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Creamos un grupo de seguridad de red (NSG).&lt;/li&gt;
  &lt;li&gt;En el NSG definimos el tráfico que vamos a autorizar incluyendo reglas de seguridad. De momento solo se va a permitir la regla de entrada por SSH.&lt;/li&gt;
  &lt;li&gt;Asociamos el NSG con todas las NIC de las VMs que se van a desplegar. De esta forma la regla que creamos se aplica a todas las VMs.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Contenido del archivo security.tf:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Grupo de seguridad de red

resource &quot;azurerm_network_security_group&quot; &quot;mySecGroup&quot; {
    name = &quot;nsg-k8s&quot;
    location = azurerm_resource_group.rg.location
    resource_group_name = azurerm_resource_group.rg.name

    security_rule {
        name = &quot;SSH&quot;
        priority = &quot;1001&quot;
        direction =&quot;Inbound&quot;
        access = &quot;Allow&quot;
        protocol = &quot;Tcp&quot;
        source_port_range = &quot;*&quot;
        destination_port_range = &quot;22&quot;
        source_address_prefix = &quot;*&quot;
        destination_address_prefix = &quot;*&quot;
    }

    tags = {
        environment = &quot;lab-0001&quot;
    }
}

# Vincular grupo de seguridad de red con interfaz de red de vm master

resource &quot;azurerm_network_interface_security_group_association&quot; &quot;associationmaster&quot; {
    network_interface_id = azurerm_network_interface.nicmaster.id
    network_security_group_id = azurerm_network_security_group.mySecGroup.id
}


# Vincular grupo de seguridad de red con interfaz de red de worker01 y worker02

resource &quot;azurerm_network_interface_security_group_association&quot; &quot;associationworers&quot; {
    count = length(var.workers)
    network_interface_id = azurerm_network_interface.nicworkers[count.index].id
    network_security_group_id = azurerm_network_security_group.mySecGroup.id
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;configuración-del-archivo-vmtf&quot;&gt;Configuración del archivo vm.tf&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Definimos la creación de la VM master.&lt;/li&gt;
  &lt;li&gt;Definimos la creación de las VMs workers.&lt;/li&gt;
  &lt;li&gt;Definimos el tamaño.&lt;/li&gt;
  &lt;li&gt;Le asignamos las NICs creadas en network.tf.&lt;/li&gt;
  &lt;li&gt;Indicamos el usuario administrador.&lt;/li&gt;
  &lt;li&gt;Especificamos la clave pública para el usuario administrador. Para crear una clave SSH, para poder conectarnos a la VM hacemos uso del siguiente comando ssh-keygen -t rsa -b 4096. Por defecto la clave se almacena en ~/.ssh, el nombre que le hemos asignado es id_rsa_cp2_devops porque ya disponía de una clave con el nombre por defecto (id_rsa). No hemos asignado una contraseña a la clave para esta práctica. Una vez dispongamos de la clave SSH hay que restablecer la ruta de la misma en el fichero vm.tf.&lt;/li&gt;
  &lt;li&gt;Utilizaremos el usuario especificado y la clave privada asociada a la pública para acceder a la VM.&lt;/li&gt;
  &lt;li&gt;Definimos el tipo de disco y la replicación (Standar_LRS).&lt;/li&gt;
  &lt;li&gt;Cuando definamos images del Marketplace tendremos que definir plan y source_image_reference con los datos de la imagen que utilizaremos.&lt;/li&gt;
  &lt;li&gt;Definimos la storage account a utilizar para almacenar información de troubleshooting.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Para definir la imagen a desplegar del Marketplace, para ver todas las disponibles con CentOS ejecutamos el siguiente comando:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;az vm image list --offer CentOS --all --output table
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Desde la salida que obtenemos en formato tabla podemos elegir la imagen y tendremos otros datos necesarios para incluir en vm.tf como son offer, publisher, version, name, plan, sku y product. Una vez seleccionada una imagen, tendremos que aceptar los términos de uso de esta, si no, porque desde Terraform no es posible aceptar esos términos y condiciones. Para esta práctica se ha elefido la siguiente imagen:&lt;/p&gt;

&lt;p&gt;name = “centos-8-3-free”
product = “centos-8-3-free”
publisher = “cognosys”
offer = “centos-8-3-free”
sku = “centos-8-3-free”
version = “1.2019.0810”&lt;/p&gt;

&lt;p&gt;Por lo tanto, el comando a ejecutar para aceptar los términos y condiciones es:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;az vm image terms accept --offer centos-8-3-free --plan 1.2019.0810 --publisher cognosys
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Contenido del archivo vm.tf:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Creación de máquina master

resource &quot;azurerm_linux_virtual_machine&quot; &quot;vmmaster&quot; {
    name = &quot;master&quot;
    resource_group_name = azurerm_resource_group.rg.name
    location = azurerm_resource_group.rg.location
    size = var.vm_size_master
    admin_username = &quot;rafadmin&quot;
    network_interface_ids = [ azurerm_network_interface.nicmaster.id ]
    disable_password_authentication = true
    admin_ssh_key {
        username = &quot;rafadmin&quot;
        public_key = file (&quot;~/.ssh/id_rsa_cp2_devops.pub&quot;)
    }


    os_disk {
        caching = &quot;ReadWrite&quot;
        storage_account_type = &quot;Standard_LRS&quot;
    }

    plan {
        name = &quot;centos-8-3-free&quot;
        product = &quot;centos-8-3-free&quot;
        publisher = &quot;cognosys&quot;
    }
  
      source_image_reference {
        publisher = &quot;cognosys&quot;
        offer = &quot;centos-8-3-free&quot;
        sku = &quot;centos-8-3-free&quot;
        version = &quot;1.2019.0810&quot;
    }

    boot_diagnostics {
        storage_account_uri = azurerm_storage_account.stAccount.primary_blob_endpoint
    }

    tags = {
        environment = &quot;lab-0001&quot;
    }

}


# Creación de máquinas virtuales worker01 y worker02

resource &quot;azurerm_linux_virtual_machine&quot; &quot;vmsworkers&quot; {
    name = &quot;${var.workers[count.index]}&quot;
    count = length(var.workers)
    resource_group_name = azurerm_resource_group.rg.name
    location = azurerm_resource_group.rg.location
    size = var.vm_size_workers
    admin_username = &quot;rafadmin&quot;
    network_interface_ids = [ azurerm_network_interface.nicworkers[count.index].id ]
    disable_password_authentication = true

    admin_ssh_key {
        username = &quot;rafadmin&quot;
        public_key = file (&quot;~/.ssh/id_rsa_cp2_devops.pub&quot;)
    }

    os_disk {
        caching = &quot;ReadWrite&quot;
        storage_account_type = &quot;Standard_LRS&quot;
    }

    plan {
        name = &quot;centos-8-3-free&quot;
        product = &quot;centos-8-3-free&quot;
        publisher = &quot;cognosys&quot;
          }

    source_image_reference {
        publisher = &quot;cognosys&quot;
        offer = &quot;centos-8-3-free&quot;
        sku = &quot;centos-8-3-free&quot;
        version = &quot;1.2019.0810&quot;
    }

    boot_diagnostics {
        storage_account_uri = azurerm_storage_account.stAccount.primary_blob_endpoint
    }

    tags = {
        environment = &quot;lab-0001&quot;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;despliegue-automatizado-de-la-infraestructura-con-terraform&quot;&gt;Despliegue automatizado de la infraestructura con Terraform&lt;/h1&gt;

&lt;p&gt;Una vez configuramos todos los archivos .tf es hora de preparar, planear y aplicar.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Preparar la infraestructura&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;La primera vez que se va a realizar un despliegue o tras aplicar cambios en los archivos .tf debemos inicializar la configuración de Terraform, para ello ejecutamos el siguiente comando:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;terraform init
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Si todo ha ido correctamente debemos obtener el siguiente resultado:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/terraform-init.png&quot; alt=&quot;Ejecución de &apos;terraform init&apos;&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Realizar un plan&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;El segundo paso es realizar un terraform plan. Esta funcionalidad nos permite ver las acciones que se van a realizar para lograr el estado deseado, para ello ejecutamos el siguiente comando:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;terraform plan
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Debemos obtener una salida sin errores, donde nos detalle que recursos vamos añadir, actualizar o destruir.&lt;/p&gt;

&lt;p&gt;Si observamos toda la salida, nos vendrá marcada con un + sobre todos los reucrsos que se van a crear. Esto puede variar cuando realicemos un cambio a futuro, si un recurso se va a destruir viene indicado con un -, si se va actualizar con un ~. De esta forma nos permite ver las acciones que se van a llevar a cabo antes del despligue.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/terraform-plan.png&quot; alt=&quot;Ejecución de &apos;terraform plan&apos;&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Aplicar el despliegue&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Por último, para aplicar el despliegue tendremos que ejecutar el comando&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;terraform apply
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Este comando ejecutará primero un plan, que posteriormente tendremos que aceptar con un ‘yes’ o ‘no’ para realizar o no el despliegue.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/terraform-apply.png&quot; alt=&quot;Ejecución de &apos;terraform apply&apos;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Durante el despliegue podemos ver la salida de los recursos que se están creado. Tras la finalización podremos observar que recursos se han agregado, actualizado o destruido. En este caso solo se deben crear recursos.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/terraform-apply-output.png&quot; alt=&quot;Salida obtenida tras aplicar &apos;terraform apply&apos;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Terraform almacena el estado de la infraestructura en un archivo llamado terraform.state. De esta forma Terraform detecta cuando se producen cambios en la infraestructura, compara los archivos .tf con el .state. Si se agregan nuevos recursos a los ficheros .tf detectará que no existen en .state y los creará, si se elimina algún recursos de los archivos .tf detectará que en .state está y los eliminará y por último si se realiza una acutalización de un recurso en el archivo .tf por ejemplo cambiar una IP de estática a dinámica, Terraform detectará que en el .state existe la IP como estática y aplicará el cambio a dinámica.&lt;/p&gt;

&lt;p&gt;Tras realizar el despliegue podemos comprobar en Azure los recursos que se han creado:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/grupo-de-recursos-lab0001.png&quot; alt=&quot;Creación grupo de recursos lab_0001&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/recursos-lab0001.png&quot; alt=&quot;Recursos lab_0001&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/vms-lab0001.png&quot; alt=&quot;Máquinas virtuales lab_0001&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Para destruir o eliminar la infraestructura creada tenemos que ejecutar el siguiente comando y confirmar con ‘yes’:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;terraform destroy
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/terraform-destroy.png&quot; alt=&quot;Ejecución comando &apos;terraform destroy&apos;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Tras confirmar la eliminación obtendremos la siguiente salida:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/destroy-output.png&quot; alt=&quot;Salida comando &apos;terraform destroy&apos;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Fin del laboratorio, cualquier duda pueden dejar sus comentarios.&lt;/p&gt;
</description>
                <pubDate>Sun, 10 Jul 2022 16:12:33 +0200</pubDate>
                <link>http://localhost:4000/primeros-pasos-con-terraform-y-desplegando-infraestructura-como-codigo-en-azure</link>
                <guid isPermaLink="true">http://localhost:4000/primeros-pasos-con-terraform-y-desplegando-infraestructura-como-codigo-en-azure</guid>
                
                <category>Terraform</category>
                
                <category>Azure</category>
                
                
            </item>
        
            <item>
                <title>Instalación de subsistema de Windows para Linux (WSL) y Ubuntu 22.04 LTS</title>
                <description>&lt;p&gt;En el siguiente artículo vamos habilitar WSL, una característica integrada en Windows 11 que nos permitirá ejecutar una distribución de Linux. Tomaremos de ejemplo la distribución de Ubuntu 22.04 LTS.&lt;/p&gt;

&lt;h1 id=&quot;habilitar-subsistema-de-windows-para-linux-wsl&quot;&gt;Habilitar subsistema de Windows para Linux (WSL)&lt;/h1&gt;

&lt;p&gt;Hay dos opciones para habilitar esta características, desde PowerShell o desde la configuración de Windows 11.&lt;/p&gt;

&lt;p&gt;Para habilitar WSL &lt;strong&gt;desde PowerShell&lt;/strong&gt; ejecutamos el siguiente comando:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wsl --install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Para habilitarlo desde el entorno gráfico de Windows 11 tenemos que ir a menú inicio, configuración, aplicaciones, características opcionales, más características de Windows y marcamos Subsistema de Windows para Linux.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/activar-subsistema-de-windows-para-linux.png&quot; alt=&quot;Activar subsistemas de Windows para Linux&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Una vez habilitado WSL será necesario aplicar un reinicio del sistema.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&quot;instalar-ubuntu-2204-lts&quot;&gt;Instalar Ubuntu 22.04 LTS&lt;/h1&gt;

&lt;p&gt;Para la instalación de la distribución Ubuntu 22.04 LTS, realizamos la busqueda de esta en Microsoft Store.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/ubuntu-22-04-microsoft-store.png&quot; alt=&quot;Ubuntu 22.04 LTS en Microsoft Store&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Tras finalizar la instalación hacemos la busqueda de Ubuntu desde el menú inicio y lo ejecutamos.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/ubuntu-22-04-menu-inicio.png&quot; alt=&quot;Ubuntu 22.04 en menú inicio Windows 11&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Se ejecutará el asistente de instalación y configuración de Ubuntu en WSL. Este proceso puede tardar unos minutos.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/asistente-instalacion-ubuntu-wsl.png&quot; alt=&quot;Asistente de instalación de Ubuntu en WSL&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Configuramos el idioma de la distribución.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/idioma-ubuntu-22-04-wsl.png&quot; alt=&quot;Configuración idioma Ubuntu 22.04 LTS en WSL&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Establecemos un nombre de usuario y contraseña para el inicio de sesión en Ubuntu.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/usuario-contraseña-ubuntu-22-04-wsl.png&quot; alt=&quot;Configuración usuario y contraseña en Ubuntu 22.04 LTS en WSL&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Indicamos la ubicación de montaje y la regeneración del archivo host y resolv.conf. Aplicar la configuración que se adapte a vuestras necesidades, en este caso, para este artículo he dejado las opciones por defecto.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/opciones-montaje-ubuntu-22-04-wsl.png&quot; alt=&quot;Opciones de montaje, regeneración de archivo host y resolv.conf&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Por último y si todo ha ido bien nos confirmará el éxito de la configuración.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/fin-configuracion-ubuntu-22-04-wsl.png&quot; alt=&quot;Fin configuración Ubuntu 22.04 LTS en WSL&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Al volver ejecutar Ubuntu 22.04 LTS, ya podremos trabajar desde el terminal.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/terminal-ubuntu-22-04-wsl.png&quot; alt=&quot;Terminal Ubuntu 22.04 LTS en WSL &quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;otros-comandos-útiles&quot;&gt;Otros comandos útiles&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;Ver lista de distribuciones disponibles.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wsl --list --online
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
  &lt;li&gt;Instalar una distribución disponible.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wsl --install -d &amp;lt;DistroName&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Enumerar distribuciones instaladas con la versión WSL establecida.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wsl -l -v
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Establecer la versión predeterminada en WSL 1 o WSL 2 cuando se instala una distribución (reemplazar &amp;lt;Version#&amp;gt; por 1 o 2).&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wsl --set-default-version &amp;lt;Version#&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Actualizar distribución de WSL 1 a WSL 2&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wsl --set-default-version &amp;lt;Version#&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</description>
                <pubDate>Wed, 06 Jul 2022 11:57:17 +0200</pubDate>
                <link>http://localhost:4000/instalacion-de-wsl-y-ubuntu-22-04-lts-en-windows-11</link>
                <guid isPermaLink="true">http://localhost:4000/instalacion-de-wsl-y-ubuntu-22-04-lts-en-windows-11</guid>
                
                <category>Windows 11</category>
                
                <category>Ubuntu 22.04 LTS</category>
                
                <category>WSL</category>
                
                
            </item>
        
            <item>
                <title>Activar/desactivar la autenticación SMTP en cuentas de Exchange Online</title>
                <description>&lt;p&gt;El protocolo SMTP se usa en los siguientes escenarios en Microsoft 365:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Clientes POP3 e IMAP4&lt;/li&gt;
  &lt;li&gt;Aplicaciones, servidores de informes y dispositivos multifunción que generan y envían mensajes de correo electrónico.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;El puerto que se usa para la autenticación SMTP es TCP 587.&lt;/p&gt;

&lt;p&gt;Se recomienda habilitar la autenticación SMTP solo para las cuentas o buzones que lo requieran dado que todos los clientes de correo eletrónico modernos que se conectan a Exchange Online o Microsoft 365, como por ejemplo, Outlook, Outlook en la web, Mail de iOS, Outlook para iOS y Android, etc. no usan la autenticación SMTP para enviar mensajes de correo electrónico.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Si ha habilitado los valores predeterminados de seguridad en su empresa, AUTH SMTP ya está deshabilitado en Exchange Online.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;requisitos-para-activar-o-desactivar-smtp-y-conexión-a-exchange-online-mediante-powershell&quot;&gt;Requisitos para activar o desactivar SMTP y conexión a Exchange Online mediante PowerShell&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;Tener habilitada la ejecución de scripts.
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Set-ExecutionPolicy&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;RemoteSigned&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Tener instalado el módulo de Azure AD.
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Install-Module&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;MSOnline&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Creamos un objeto de credenciales, para ello ejecutamos el siguiente comando e introducimos las credenciales de nuestro administrador global de Microsoft 365.
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$credential&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-Credential&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Importamos el módulo de Microsoft 365, para ello ejecutamos el siguiente comando.
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Import-Module&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;MsOnline&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Con el objeto de credenciales que creamos anteriormente con el módulo MSOnline, ahora nos podemos conectar a Microsoft 365 ejecutando el siguiente comando.
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Connect-MsolService&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Credential&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$credential&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Ejecutamos el siguiente comando para crear una sesión remota de Exchange Online.
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$exchangeSession&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;New-PSSession&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ConfigurationName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Microsoft.Exchange&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ConnectionUri&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;https://outlook.office365.com/powershell-liveid/&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Credential&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$credential&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Authentication&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Basic&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;–&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;AllowRedirection&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Import-PSSession&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$exchangeSession&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;deshabilitar-autenticación-smtp&quot;&gt;Deshabilitar autenticación SMTP&lt;/h2&gt;

&lt;p&gt;Conectados a Exchange Online remotamente por PowerShell para deshabilitar SMTP globalmente en la compañía, ejecutamos el siguiente comando.&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Set-TransportConfig&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SmtpClientAuthenticationDisabled&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$true&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Para comprobar que se ha deshabilitado la autenticación SMTP ejecutamos el siguiente comando y comprobamos que el valor de la propiedad SmtpClientAuthenticationDisablede es True.&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Get-TransportConfig&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Format-List&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SmtpClientAuthenticationDisabled&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;habilitar-autenticación-smtp&quot;&gt;Habilitar autenticación SMTP&lt;/h2&gt;

&lt;p&gt;Conectados a Exchange Online remotamente por PowerShell comprobamos el usuario, donde usuario@contoso.com introducimos la cuenta de usuario a revisar.&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Get-CASMailbox&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Identity&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Usuario&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;contoso.com&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Format-List&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SmtpClientAuthenticationDisabled&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Si nos carga el usuario con el valor en blanco o $True ejecutaríamos el siguiente comando para habilitar la autenticación SMTP.&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Set-CASMailbox&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Identity&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;sean&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;contoso.com&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SmtpClientAuthenticationDisabled&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$false&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Documentación de apoyo:
https://docs.microsoft.com/es-es/exchange/clients-and-mobile-in-exchange-online/authenticated-client-smtp-submission&lt;/p&gt;
</description>
                <pubDate>Fri, 01 Jul 2022 14:01:35 +0200</pubDate>
                <link>http://localhost:4000/activar-desactivar-autenticacion-smtp-cuentas-exchange-online</link>
                <guid isPermaLink="true">http://localhost:4000/activar-desactivar-autenticacion-smtp-cuentas-exchange-online</guid>
                
                <category>Microsoft 365</category>
                
                <category>Exchange Online</category>
                
                
            </item>
        
    </channel>
</rss>